FROM node:20-alpine

WORKDIR /app

# Install dependencies
COPY package*.json ./
RUN npm ci --only=production

# Copy application files
COPY dist ./dist
COPY frontend/dist ./frontend/dist
COPY public ./public
COPY entrypoint.sh ./

RUN chmod +x entrypoint.sh

# Create necessary directories
RUN mkdir -p logs documents/storage documents/temp documents/thumbnails

EXPOSE 3000

ENTRYPOINT ["./entrypoint.sh"]